<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Utils.RLS">
<Super>%Persistent</Super>
<TimeCreated>64267,84995.150945</TimeCreated>

<Parameter name="ROWLEVELSECURITY">
<Default>1</Default>
</Parameter>

<Property name="%READERLIST">
<Type>%String</Type>
<Calculated>1</Calculated>
<Private>1</Private>
<SqlComputeCode>s {*} = ^test</SqlComputeCode>
<SqlComputed>1</SqlComputed>
</Property>

<Property name="f1">
<Type>%String</Type>
</Property>

<Property name="f2">
<Type>%Integer</Type>
</Property>

<Method name="Fill">
<Description>
d ##class(Utils.RLS).Fill()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>N=3</FormalSpec>
<Implementation><![CDATA[
  d ..%KillExtent()
  f i=1:1:N &sql(insert into Utils.RLS(f1,f2) values('f'||:i,:i))
  
  zw ^demo.testD,^demo.testI w !
  
  d ..Test()
]]></Implementation>
</Method>

<Method name="Test">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
  d $SYSTEM.SQL.SetMapSelectability($classname(),"%RLI",$$$YES), $system.SQL.PurgeForTable($classname())
  
  w "yes 1) -----",!!
  d ##class(%SQL.Statement).%ExecDirect(,"select * from %IGNOREINDEX %RLI "_$classname()).%Display() w !!
  w "yes 2) -----",!!
  d ##class(%SQL.Statement).%ExecDirect(,"select * from "_$classname()).%Display() w !!

  d $SYSTEM.SQL.SetMapSelectability($classname(),"%RLI",$$$NO), $system.SQL.PurgeForTable($classname())
  
  w "no 1) -----",!!
  d ##class(%SQL.Statement).%ExecDirect(,"select * from %IGNOREINDEX %RLI "_$classname()).%Display() w !!
  w "no 2) -----",!!
  d ##class(%SQL.Statement).%ExecDirect(,"select * from "_$classname()).%Display() w !!
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Utils.RLSD</DataLocation>
<DefaultData>RLSDefaultData</DefaultData>
<IdLocation>^Utils.RLSD</IdLocation>
<IndexLocation>^Utils.RLSI</IndexLocation>
<StreamLocation>^Utils.RLSS</StreamLocation>
<Data name="RLSDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>f1</Value>
</Value>
<Value name="3">
<Value>f2</Value>
</Value>
</Data>
</Storage>
</Class>
</Export>
